# Программы для проекта с использованием Raspberry Pi и Arduino

[Вернуться на главный README](../README.md)

- `rpi_arduino/rpi/main.py`: программа для запуска на Raspberry Pi. Выполняет следующие функции:
    - Захват видео с камеры – Использует Picamera2 для получения видеопотока и передает кадры через HTTP.
    - Классификация изображений – Загружает модель машинного обучения TensorFlow Lite, выполняет распознавание объектов на кадрах и аннотирует изображения.
    - Взаимодействие с Arduino – Подключается к Arduino через Serial (UART), обрабатывает команды, анализирует последние 10 предсказаний и отправляет результаты обратно.
    - Потоковая передача видео – Веб-сервер на HTTP передает обработанные кадры в формате MJPEG, позволяя просматривать видеопоток в браузере.
    - Автоматическое обнаружение и подключение к Arduino – Программа ищет доступные порты и при необходимости выполняет reset USB.
    - Обслуживание многопользовательских соединений – Запускает многопоточный HTTP-сервер, который раздает HTML-страницу и поток видео.

- `rpi_arduino/arduino/main/main.ino`: программа для запуска на Arduino. Выполняет следующие функции:
    - Обнаружение объектов – Использует три типа датчиков (ИК-датчик препятствий, ультразвуковой HC-SR04 и инфракрасный дальномер Sharp) для определения присутствия объекта на конвейере. Если объект обнаружен, шаговый двигатель останавливается, и программа ожидает команду от компьютера через Serial (UART).
    - Классификация объектов – После получения команды (GOOD, BAD или SKIP), программа управляет сервоприводом, сортируя объект:
        - GOOD → сервопривод поворачивается в одну сторону.
        - BAD → сервопривод поворачивается в другую сторону.
        - SKIP → объект остается на месте.
    - Запуск и остановка конвейера – Включает и выключает шаговый двигатель в зависимости от состояния системы.
    - Многократные измерения и сглаживание данных – Для точного определения расстояния используется фильтрация значений.
    - Вывод данных в Serial Monitor – Программа отправляет информацию о состоянии системы (обнаружение объекта, команда, вращение двигателя и т. д.).

## Запуск программ

Скачайте репозиторий:
```
git clone https://github.com/aleksioprime/innoprojects.git
cd innoprojects
```

Или загрузите его архив:
```
wget https://github.com/aleksioprime/innoprojects/archive/refs/heads/main.zip
unzip main.zip
rm main.zip
cd innoprojects-main
```

### Загрузка программы на Arduino

Скачайте и установите [Arduino IDE](https://www.arduino.cc/en/software):

Откройте программу `rpi_arduino/arduino/main/main.ino` и выполните загрузку на плату Arduino UNO

### Загрузка программы на Raspberry Pi:

Загрузите программу на микрокомпютер через SFTP-приложения или с помощью команды терминала:

```
scp -r rpi_arduino/rpi/* <имя пользователя>@<IP-адрес>:app
```

Если вы изменяете программу и выгружаете снова, то можно использовать следующую команду:
```
rsync -av rpi_arduino/rpi/* <имя пользователя>@<IP-адрес>:app
```

### Запуск программ

Подключитесь к Raspberry Pi по SSH через SSH-приложение или с помощью команды терминала:
```
ssh <имя пользователя>@<IP-адрес>
```

Запустите виртуальное окружение
```
source ~/venv/bin/activate
```

Подключите Arduno Uno к микрокомпьютеру Raspberry Pi через USB-кабель и запустите программу:
```
python app/main.py
```
